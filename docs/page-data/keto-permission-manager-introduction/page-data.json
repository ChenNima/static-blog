{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/keto-permission-manager-introduction","result":{"data":{"markdownRemark":{"html":"<p>用户的权限管理对每个项目来说都至关重要。不同的业务场景决定了不同的权限管理需求，不同的技术栈也有不同的解决方案：如果你在写一个Ruby On Rails应用，那你可能会选择<a href=\"https://github.com/ryanb/cancan\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">cancan</a>， 如果你正在使用K8S，那你很可能需要与K8S的<a href=\"https://kubernetes.io/docs/reference/access-authn-authz/rbac/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">RBAC</a>系统打交道。那如果你面对一个非常复杂的业务，需要实现极为灵活的权限配置，并且同时对接多个服务怎么办呢？谷歌的一致性全球授权系统<a href=\"https://research.google/pubs/pub48190/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Zanzibar</a>以及其开源实现<a href=\"https://github.com/ory/keto\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Ory/Keto</a>或许可以帮到你。</p>\n<h1>Zanzibar</h1>\n<h2>简介</h2>\n<p>Google Zanzibar是谷歌2016年起上线的一致性全球授权系统。这套系统的主要功能是</p>\n<ol>\n<li>储存来自各个服务的访问控制列表(Access Control Lists, ACLs)，也就是所谓的权限(Permission)。</li>\n<li>根据储存的ACL，进行权限校验。</li>\n</ol>\n<p>这套系统上线后对接的服务有谷歌地图，谷歌图片，谷歌云盘，GCP，以及Youtube等等重要的服务\n<span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 700px; '>\n      <a class='gatsby-resp-image-link' href='/static/e28748490b624bdd57852aa20051a8b3/8733b/google-zanzibar.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 55.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACUElEQVQoz02SXW/SYBiG+yP8Hyb+i/0Hf4NHnpgYPw7MDoweeKIxnizGqQfOGLeEOTM3RoYKA7ZlCi3fQ2hpgVKghX5w+fYFsrW50z5P7ufK/T6tEs4jgihWKOXHzzDAD8NFP/AJfKEwXHoiZuFqJpK+WRAQc2Ipo8kEs2fRMXT0bpeR7dCfuHS6BobZRR+P6fkBbcOga1mYloEztLD6feFfeOK+O50SMUe5ni6cw14rSzXxiShOJSxeNoWb3GXmucRX03LJVhymy1SBTDaXacNIABfFnEgoBtxPviL18b0c9qcu/bWbDG7dwG9UZO/wwubuZgdr5Mt6dfQVR7naoYDOAyzHxxReYRE3uLU69tkZg3gVjo1j2wz7nkh4lWw1L3d41QgFUKQKLUHrSJjvu4ybCXrFd3Q7ZZyRi2Y0+XFZYBavKLoOXEgeOVYkNBNLfXi8QeH8sxgAu7qH8Uyh9VhhcvpcHnFXz7O2/4TubCTraKkVR3G9KRPPk19pPB3zTW2TqXl4M1HbHfSjR1zu3sGs/aQ/nHBp6ezXTrEGfbEGm95ggDMeyXlXcJT4V1nIQDdNxt02w2pRvhs9m1arR13VUGtN/paKlMsaDU2lpJb4UyyKXolmqyV+H1MyFLVcJlZJ06g1W3xPrPPm6QvU+j/UapmLnXW2PnyloDbQ23U2vmS4/WCbX4US9UYNrVpFq1QkQxNSkqkUqeNjsvkchfwZifQeWwdJTnKn5HNZtg/f8nr7iPTvHOfneTZ30tx7ecBhOkuukCOTy5FdKnNywn/KICnfPFYHnwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='google-zanzibar' title='google-zanzibar' src='/static/e28748490b624bdd57852aa20051a8b3/8c557/google-zanzibar.png' srcset='/static/e28748490b624bdd57852aa20051a8b3/4edbd/google-zanzibar.png 175w,\n/static/e28748490b624bdd57852aa20051a8b3/13ae7/google-zanzibar.png 350w,\n/static/e28748490b624bdd57852aa20051a8b3/8c557/google-zanzibar.png 700w,\n/static/e28748490b624bdd57852aa20051a8b3/e996b/google-zanzibar.png 1050w,\n/static/e28748490b624bdd57852aa20051a8b3/2cefc/google-zanzibar.png 1400w,\n/static/e28748490b624bdd57852aa20051a8b3/8733b/google-zanzibar.png 1495w' sizes='(max-width: 700px) 100vw, 700px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy'>\n  </a>\n    </span>\n为了服务如此重要的业务，Zanzibar有着以下特点：</p>\n<ol>\n<li>一致性：面对并发度如此大的业务场景，Zanzibar在检查权限的同时必须保证按照各个ACL的添加顺序判断。比如A添加了一条规则后立即删除，这两个动作如果没有按照正确的顺序执行，那么会造成权限泄露。</li>\n<li>灵活性：各个业务场景的鉴权需求都不尽相同，所以Zanzibar灵活地支持不同的权限模式</li>\n<li>横向扩展：以横向扩展支持数万亿条规则，每秒百万级鉴权</li>\n<li>性能：95%的请求10毫秒内完成，99%的请求100毫秒内完成</li>\n<li>可用性：上线三年间保证了99.999%的可用时间</li>\n</ol>\n<p>以上的各个特性中除了灵活性之外都是性能或算法上的特点，性能和可靠性上也有很大一部分得益于底层的<a href=\"https://research.google/pubs/pub39966/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Spanner</a>数据库。如果有兴趣可以阅读以下这篇论文：<a href=\"https://research.google/pubs/pub48190/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Zanzibar: Google’s Consistent, Global Authorization System</a>对Zanzibar进行更深入的了解。下面我们就灵活性这一特点看一下Zanzibar是如何定义鉴权模型的。</p>\n<h2>概念与定义</h2>\n<h3>关系元组(Relation Tuples)</h3>\n<p>Relation Tuples是Zanzibar的核心概念，一条Relation Tuples就对应了一条ACL。关系元组由命名空间(Namespace)，对象(Object)，关系(Relation)和主体(Subject)组成。一条Relation Tuples可以用<a href=\"https://en.wikipedia.org/wiki/Backus%E2%80%93Naur_form\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">BNF语法</a>这样描述：</p>\n<div class=\"gatsby-highlight\" data-language=\"bnf\"><pre class=\"language-bnf\"><code class=\"language-bnf\"><span class=\"token definition rule keyword\"><span class=\"token punctuation\">&lt;</span>relation-tuple<span class=\"token punctuation\">></span></span> <span class=\"token operator\">::=</span> <span class=\"token rule\"><span class=\"token punctuation\">&lt;</span>object<span class=\"token punctuation\">></span></span><span class=\"token string\">'#'</span>relation<span class=\"token string\">'@'</span><span class=\"token rule\"><span class=\"token punctuation\">&lt;</span>subject<span class=\"token punctuation\">></span></span>\n<span class=\"token definition rule keyword\"><span class=\"token punctuation\">&lt;</span>object<span class=\"token punctuation\">></span></span> <span class=\"token operator\">::=</span> namespace<span class=\"token string\">':'</span>object_id\n<span class=\"token definition rule keyword\"><span class=\"token punctuation\">&lt;</span>subject<span class=\"token punctuation\">></span></span> <span class=\"token operator\">::=</span> subject_id <span class=\"token operator\">|</span> <span class=\"token rule\"><span class=\"token punctuation\">&lt;</span>subject_set<span class=\"token punctuation\">></span></span>\n<span class=\"token definition rule keyword\"><span class=\"token punctuation\">&lt;</span>subject_set<span class=\"token punctuation\">></span></span> <span class=\"token operator\">::=</span> <span class=\"token rule\"><span class=\"token punctuation\">&lt;</span>object<span class=\"token punctuation\">></span></span><span class=\"token string\">'#'</span>relation</code></pre></div>\n<p>一条Relation Tuples写作</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">namespace:object#relation@subject</code></pre></div>\n<p>意味着<code class=\"language-text\">subject</code>对<code class=\"language-text\">namespace</code>中的<code class=\"language-text\">object</code>有一种<code class=\"language-text\">relation</code>。</p>\n<p>换成更有语义的例子：</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">videos:cat.mp4#view@felix</code></pre></div>\n<p>就意味着<code class=\"language-text\">felix</code>对<code class=\"language-text\">videos</code>中的<code class=\"language-text\">cat.mp4</code>有<code class=\"language-text\">view</code>的关系。</p>\n<p>上述BNF定义的第四条<code class=\"language-text\">subject_set</code>是由<code class=\"language-text\">&lt;object&gt;&#39;#&#39;relation</code>组成的，也就是代表了一群对某种<code class=\"language-text\">object</code>有<code class=\"language-text\">relation</code>的<code class=\"language-text\">subject</code>。举例来说就是</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">groups:admin#member@felix\ngroups:admin#member@john\nvideos:cat.mp4#view@(groups:admin#member)</code></pre></div>\n<p>在这个例子中，<code class=\"language-text\">felix</code>和<code class=\"language-text\">john</code>都对<code class=\"language-text\">groups:admin</code>有<code class=\"language-text\">member</code>的关系，而对<code class=\"language-text\">groups:admin</code>有<code class=\"language-text\">member</code>的关系的<code class=\"language-text\">subject_set</code>对<code class=\"language-text\">videos:cat.mp4</code>有<code class=\"language-text\">view</code>的关系。也就是说<code class=\"language-text\">felix</code>和<code class=\"language-text\">john</code>都对<code class=\"language-text\">videos:cat.mp4</code>有<code class=\"language-text\">view</code>的关系。这种嵌套的语法可以有很多层，从而达到了整个ACL规则灵活可配的目的。</p>\n<h3>命名空间(Namespaces)， 对象(Object)与主体(Subject)</h3>\n<p>Zanzibar中的Namespace并不是起隔离作用的，就像上面的那个例子，在编写<code class=\"language-text\">videos</code>Namespace时也可以引用<code class=\"language-text\">groups</code>Namespace。这里的命名空间概念更多是用来将数据分为同质的分块（并应用不同的配置），并且在储存层面上也是分离的。所以在多租户的使用场景中，用租户的UUID作为Namespace并不是一个好的选择，而应该使用<code class=\"language-text\">tenants</code>作为Namespace，从而实现</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">tenants:tenant-id-1#member@felix\ntenants:tenant-id-1#member@john</code></pre></div>\n<p>这样的Relation Tuples，并且用<code class=\"language-text\">tenants:tenant-id-1#member</code>作为鉴权的<code class=\"language-text\">subject_set</code>。在命名方面，一般建议<strong>Namespace使用单词的复数形式，而Object和Subject使用UUID</strong>。\n将Relation Tuples转换为图有助于更好地理解object与subject之间的关系，考虑<a href=\"https://www.ory.sh/keto/docs/concepts/graph-of-relations\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Keto官方文档</a>上的以下例子</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// user1 has access on dir1</span>\ndir1#access<span class=\"token annotation punctuation\">@user1</span>\n<span class=\"token comment\">// Have a look on the subjects concept page if you don't know the empty relation.</span>\ndir1#parent@<span class=\"token punctuation\">(</span>file1#<span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// Everyone with access to dir1 has access to file1. This would probably be defined</span>\n<span class=\"token comment\">// through a subject set rewrite that defines this inherited relation globally.</span>\n<span class=\"token comment\">// In this example, we define this tuple explicitly.</span>\nfile1#access@<span class=\"token punctuation\">(</span>dir1#access<span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// Direct access on file2 was granted.</span>\nfile2#access<span class=\"token annotation punctuation\">@user1</span>\n<span class=\"token comment\">// user2 is owner of file2</span>\nfile2#owner<span class=\"token annotation punctuation\">@user2</span>\n<span class=\"token comment\">// Owners of file2 have access to it; possibly defined through subject set rewrites.</span>\nfile2#access@<span class=\"token punctuation\">(</span>file2#owner<span class=\"token punctuation\">)</span></code></pre></div>\n<p>将其转换为图可以得到:</p>\n<p><svg id=\"mermaid-\" width=\"100%\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" height=\"603\" style=\"max-width: 454.96875px;\" viewBox=\"0 0 454.96875 603\"><style>#mermaid-{font-family:\"trebuchet ms\",verdana,arial,sans-serif;font-size:16px;fill:#000000;}#mermaid- .error-icon{fill:#552222;}#mermaid- .error-text{fill:#552222;stroke:#552222;}#mermaid- .edge-thickness-normal{stroke-width:2px;}#mermaid- .edge-thickness-thick{stroke-width:3.5px;}#mermaid- .edge-pattern-solid{stroke-dasharray:0;}#mermaid- .edge-pattern-dashed{stroke-dasharray:3;}#mermaid- .edge-pattern-dotted{stroke-dasharray:2;}#mermaid- .marker{fill:#666;stroke:#666;}#mermaid- .marker.cross{stroke:#666;}#mermaid- svg{font-family:\"trebuchet ms\",verdana,arial,sans-serif;font-size:16px;}#mermaid- .label{font-family:\"trebuchet ms\",verdana,arial,sans-serif;color:#000000;}#mermaid- .cluster-label text{fill:#333;}#mermaid- .cluster-label span{color:#333;}#mermaid- .label text,#mermaid- span{fill:#000000;color:#000000;}#mermaid- .node rect,#mermaid- .node circle,#mermaid- .node ellipse,#mermaid- .node polygon,#mermaid- .node path{fill:#eee;stroke:#999;stroke-width:1px;}#mermaid- .node .label{text-align:center;}#mermaid- .node.clickable{cursor:pointer;}#mermaid- .arrowheadPath{fill:#333333;}#mermaid- .edgePath .path{stroke:#666;stroke-width:1.5px;}#mermaid- .flowchart-link{stroke:#666;fill:none;}#mermaid- .edgeLabel{background-color:white;text-align:center;}#mermaid- .edgeLabel rect{opacity:0.5;background-color:white;fill:white;}#mermaid- .cluster rect{fill:hsl(210,66.6666666667%,95%);stroke:#26a;stroke-width:1px;}#mermaid- .cluster text{fill:#333;}#mermaid- .cluster span{color:#333;}#mermaid- div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:\"trebuchet ms\",verdana,arial,sans-serif;font-size:12px;background:hsl(-160,0%,93.3333333333%);border:1px solid #26a;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-:root{--mermaid-font-family:\"trebuchet ms\",verdana,arial,sans-serif;}#mermaid- flowchart{fill:apa;}</style><g><g class=\"output\"><g class=\"clusters\"><g class=\"cluster\" id=\"flowchart-subjID-166\" transform=\"translate(227.71875,539.5)\" style=\"opacity: 1;\"><rect width=\"400.7421875\" height=\"111\" x=\"-200.37109375\" y=\"-55.5\"></rect><g class=\"label\" transform=\"translate(0, -41.5)\" id=\"mermaid-Text\"><g transform=\"translate(-61.3671875,-13)\"><foreignObject width=\"122.734375\" height=\"26\"><div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"display: inline-block; white-space: nowrap;\">Subject ID region</div></foreignObject></g></g></g><g class=\"cluster\" id=\"flowchart-obj-167\" style=\"opacity: 1;\" transform=\"translate(220.951171875,132)\"><rect width=\"396.88671875\" height=\"248\" x=\"-198.443359375\" y=\"-124\"></rect><g class=\"label\" transform=\"translate(0, -110)\" id=\"mermaid-Text\"><g transform=\"translate(-47.5859375,-13)\"><foreignObject width=\"95.171875\" height=\"26\"><div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"display: inline-block; white-space: nowrap;\">Object region</div></foreignObject></g></g></g></g><g class=\"edgePaths\"><g class=\"edgePath LS-E LE-A\" id=\"L-E-A\" style=\"opacity: 1;\"><path class=\"path\" d=\"M105.48999201642336,86.5L99.9395766803528,94.08333333333333C94.38916134428223,101.66666666666667,83.28833067214111,116.83333333333333,77.73791533607056,132C72.1875,147.16666666666666,72.1875,162.33333333333334,72.1875,169.91666666666666L72.1875,177.5\" marker-end=\"url(#arrowhead325)\" style=\"fill:none\"></path><defs><marker id=\"arrowhead325\" viewBox=\"0 0 10 10\" refX=\"9\" refY=\"5\" markerUnits=\"strokeWidth\" markerWidth=\"8\" markerHeight=\"6\" orient=\"auto\"><path d=\"M 0 0 L 10 5 L 0 10 z\" class=\"arrowheadPath\" style=\"stroke-width: 1; stroke-dasharray: 1, 0;\"></path></marker></defs></g><g class=\"edgePath LS-A LE-B\" style=\"opacity: 1;\" id=\"L-A-B\"><path class=\"path\" d=\"M72.1875,223.5L72.1875,228.91666666666666C72.1875,234.33333333333334,72.1875,245.16666666666666,72.1875,258.1666666666667C72.1875,271.1666666666667,72.1875,286.3333333333333,72.27083333333333,301.5833333333333C72.35416666666667,316.8333333333333,72.52083333333333,332.1666666666667,72.60416666666667,339.8333333333333L72.6875,347.5\" marker-end=\"url(#arrowhead326)\" style=\"fill:none\"></path><defs><marker id=\"arrowhead326\" viewBox=\"0 0 10 10\" refX=\"9\" refY=\"5\" markerUnits=\"strokeWidth\" markerWidth=\"8\" markerHeight=\"6\" orient=\"auto\"><path d=\"M 0 0 L 10 5 L 0 10 z\" class=\"arrowheadPath\" style=\"stroke-width: 1; stroke-dasharray: 1, 0;\"></path></marker></defs></g><g class=\"edgePath LS-B LE-F\" style=\"opacity: 1;\" id=\"L-B-F\"><path class=\"path\" d=\"M72.6875,393.5L72.60416666666667,401C72.52083333333333,408.5,72.35416666666667,423.5,72.27083333333333,438.5833333333333C72.1875,453.6666666666667,72.1875,468.8333333333333,81.09114583333333,481.95726757766874C89.99479166666667,495.0812018220042,107.80208333333333,506.1624036440084,116.70572916666667,511.70300455501047L125.609375,517.2436054660126\" marker-end=\"url(#arrowhead327)\" style=\"fill:none;stroke-width:2px;stroke-dasharray:3;\"></path><defs><marker id=\"arrowhead327\" viewBox=\"0 0 10 10\" refX=\"9\" refY=\"5\" markerUnits=\"strokeWidth\" markerWidth=\"8\" markerHeight=\"6\" orient=\"auto\"><path d=\"M 0 0 L 10 5 L 0 10 z\" class=\"arrowheadPath\" style=\"stroke-width: 1; stroke-dasharray: 1, 0;\"></path></marker></defs></g><g class=\"edgePath LS-E LE-F\" style=\"opacity: 1;\" id=\"L-E-F\"><path class=\"path\" d=\"M135.43615989963504,86.5L139.75929991636255,94.08333333333333C144.08243993309003,101.66666666666667,152.72871996654501,116.83333333333333,157.05185998327252,135.83333333333334C161.375,154.83333333333334,161.375,177.66666666666666,161.375,198.33333333333334C161.375,219,161.375,237.5,161.375,254.33333333333334C161.375,271.1666666666667,161.375,286.3333333333333,161.375,305.3333333333333C161.375,324.3333333333333,161.375,347.1666666666667,161.375,370C161.375,392.8333333333333,161.375,415.6666666666667,161.375,434.6666666666667C161.375,453.6666666666667,161.375,468.8333333333333,161.375,481.8333333333333C161.375,494.8333333333333,161.375,505.6666666666667,161.375,511.0833333333333L161.375,516.5\" marker-end=\"url(#arrowhead328)\" style=\"fill:none\"></path><defs><marker id=\"arrowhead328\" viewBox=\"0 0 10 10\" refX=\"9\" refY=\"5\" markerUnits=\"strokeWidth\" markerWidth=\"8\" markerHeight=\"6\" orient=\"auto\"><path d=\"M 0 0 L 10 5 L 0 10 z\" class=\"arrowheadPath\" style=\"stroke-width: 1; stroke-dasharray: 1, 0;\"></path></marker></defs></g><g class=\"edgePath LS-G LE-F\" style=\"opacity: 1;\" id=\"L-G-F\"><path class=\"path\" d=\"M253.82421875,220.11233849767885L246.29752604166666,226.0936154147324C238.77083333333334,232.0748923317859,223.71744791666666,244.03744616589293,216.19075520833334,257.6020564162798C208.6640625,271.1666666666667,208.6640625,286.3333333333333,208.6640625,305.3333333333333C208.6640625,324.3333333333333,208.6640625,347.1666666666667,208.6640625,370C208.6640625,392.8333333333333,208.6640625,415.6666666666667,208.6640625,434.6666666666667C208.6640625,453.6666666666667,208.6640625,468.8333333333333,204.04876360735736,481.8333333333333C199.4334647147147,494.8333333333333,190.20286692942943,505.6666666666667,185.5875680367868,511.0833333333333L180.97226914414415,516.5\" marker-end=\"url(#arrowhead329)\" style=\"fill:none\"></path><defs><marker id=\"arrowhead329\" viewBox=\"0 0 10 10\" refX=\"9\" refY=\"5\" markerUnits=\"strokeWidth\" markerWidth=\"8\" markerHeight=\"6\" orient=\"auto\"><path d=\"M 0 0 L 10 5 L 0 10 z\" class=\"arrowheadPath\" style=\"stroke-width: 1; stroke-dasharray: 1, 0;\"></path></marker></defs></g><g class=\"edgePath LS-G LE-C\" style=\"opacity: 1;\" id=\"L-G-C\"><path class=\"path\" d=\"M277.19752956081084,223.5L276.88986838400905,228.91666666666666C276.5822072072072,234.33333333333334,275.96688485360363,245.16666666666666,275.6592236768018,258.1666666666667C275.3515625,271.1666666666667,275.3515625,286.3333333333333,275.3515625,305.3333333333333C275.3515625,324.3333333333333,275.3515625,347.1666666666667,275.3515625,370C275.3515625,392.8333333333333,275.3515625,415.6666666666667,275.3515625,434.6666666666667C275.3515625,453.6666666666667,275.3515625,468.8333333333333,280.9882050018769,481.8333333333333C286.62484750375376,494.8333333333333,297.8981325075075,505.6666666666667,303.5347750093844,511.0833333333333L309.17141751126127,516.5\" marker-end=\"url(#arrowhead330)\" style=\"fill:none\"></path><defs><marker id=\"arrowhead330\" viewBox=\"0 0 10 10\" refX=\"9\" refY=\"5\" markerUnits=\"strokeWidth\" markerWidth=\"8\" markerHeight=\"6\" orient=\"auto\"><path d=\"M 0 0 L 10 5 L 0 10 z\" class=\"arrowheadPath\" style=\"stroke-width: 1; stroke-dasharray: 1, 0;\"></path></marker></defs></g><g class=\"edgePath LS-G LE-H\" style=\"opacity: 1;\" id=\"L-G-H\"><path class=\"path\" d=\"M303.18359375,213.41572433607132L316.7454427083333,220.5131036133928C330.3072916666667,227.61048289071422,357.4309895833333,241.8052414453571,370.9928385416667,256.4859540560119C384.5546875,271.1666666666667,384.5546875,286.3333333333333,384.6380208333333,301.5833333333333C384.7213541666667,316.8333333333333,384.8880208333333,332.1666666666667,384.9713541666667,339.8333333333333L385.0546875,347.5\" marker-end=\"url(#arrowhead331)\" style=\"fill:none\"></path><defs><marker id=\"arrowhead331\" viewBox=\"0 0 10 10\" refX=\"9\" refY=\"5\" markerUnits=\"strokeWidth\" markerWidth=\"8\" markerHeight=\"6\" orient=\"auto\"><path d=\"M 0 0 L 10 5 L 0 10 z\" class=\"arrowheadPath\" style=\"stroke-width: 1; stroke-dasharray: 1, 0;\"></path></marker></defs></g><g class=\"edgePath LS-H LE-C\" style=\"opacity: 1;\" id=\"L-H-C\"><path class=\"path\" d=\"M385.0546875,393.5L384.9713541666667,401C384.8880208333333,408.5,384.7213541666667,423.5,384.6380208333333,438.5833333333333C384.5546875,453.6666666666667,384.5546875,468.8333333333333,379.5333673517268,481.8333333333333C374.51204720345345,494.8333333333333,364.4694069069069,505.6666666666667,359.4480867586337,511.0833333333333L354.42676661036035,516.5\" marker-end=\"url(#arrowhead332)\" style=\"fill:none;stroke-width:2px;stroke-dasharray:3;\"></path><defs><marker id=\"arrowhead332\" viewBox=\"0 0 10 10\" refX=\"9\" refY=\"5\" markerUnits=\"strokeWidth\" markerWidth=\"8\" markerHeight=\"6\" orient=\"auto\"><path d=\"M 0 0 L 10 5 L 0 10 z\" class=\"arrowheadPath\" style=\"stroke-width: 1; stroke-dasharray: 1, 0;\"></path></marker></defs></g></g><g class=\"edgeLabels\"><g class=\"edgeLabel\" transform=\"translate(72.1875,132)\" style=\"opacity: 1;\"><g transform=\"translate(-22.6875,-13)\" class=\"label\"><rect rx=\"0\" ry=\"0\" width=\"45.375\" height=\"26\"></rect><foreignObject width=\"45.375\" height=\"26\"><div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"display: inline-block; white-space: nowrap;\"><span id=\"L-L-E-A\" class=\"edgeLabel L-LS-E' L-LE-A\">parent</span></div></foreignObject></g></g><g class=\"edgeLabel\" style=\"opacity: 1;\" transform=\"translate(72.1875,301.5)\"><g transform=\"translate(-24.8984375,-13)\" class=\"label\"><rect rx=\"0\" ry=\"0\" width=\"49.796875\" height=\"26\"></rect><foreignObject width=\"49.796875\" height=\"26\"><div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"display: inline-block; white-space: nowrap;\"><span id=\"L-L-A-B\" class=\"edgeLabel L-LS-A' L-LE-B\">access</span></div></foreignObject></g></g><g class=\"edgeLabel\" style=\"opacity: 1;\" transform=\"translate(72.1875,438.5)\"><g transform=\"translate(-44.0234375,-13)\" class=\"label\"><rect rx=\"0\" ry=\"0\" width=\"88.046875\" height=\"26\"></rect><foreignObject width=\"88.046875\" height=\"26\"><div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"display: inline-block; white-space: nowrap;\"><span id=\"L-L-B-F\" class=\"edgeLabel L-LS-B' L-LE-F\">file1#access</span></div></foreignObject></g></g><g class=\"edgeLabel\" style=\"opacity: 1;\" transform=\"translate(161.375,301.5)\"><g transform=\"translate(-24.8984375,-13)\" class=\"label\"><rect rx=\"0\" ry=\"0\" width=\"49.796875\" height=\"26\"></rect><foreignObject width=\"49.796875\" height=\"26\"><div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"display: inline-block; white-space: nowrap;\"><span id=\"L-L-E-F\" class=\"edgeLabel L-LS-E' L-LE-F\">access</span></div></foreignObject></g></g><g class=\"edgeLabel\" style=\"opacity: 1;\" transform=\"translate(208.6640625,370)\"><g transform=\"translate(-24.8984375,-13)\" class=\"label\"><rect rx=\"0\" ry=\"0\" width=\"49.796875\" height=\"26\"></rect><foreignObject width=\"49.796875\" height=\"26\"><div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"display: inline-block; white-space: nowrap;\"><span id=\"L-L-G-F\" class=\"edgeLabel L-LS-G' L-LE-F\">access</span></div></foreignObject></g></g><g class=\"edgeLabel\" style=\"opacity: 1;\" transform=\"translate(275.3515625,370)\"><g transform=\"translate(-21.7890625,-13)\" class=\"label\"><rect rx=\"0\" ry=\"0\" width=\"43.578125\" height=\"26\"></rect><foreignObject width=\"43.578125\" height=\"26\"><div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"display: inline-block; white-space: nowrap;\"><span id=\"L-L-G-C\" class=\"edgeLabel L-LS-G' L-LE-C\">owner</span></div></foreignObject></g></g><g class=\"edgeLabel\" style=\"opacity: 1;\" transform=\"translate(384.5546875,301.5)\"><g transform=\"translate(-24.8984375,-13)\" class=\"label\"><rect rx=\"0\" ry=\"0\" width=\"49.796875\" height=\"26\"></rect><foreignObject width=\"49.796875\" height=\"26\"><div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"display: inline-block; white-space: nowrap;\"><span id=\"L-L-G-H\" class=\"edgeLabel L-LS-G' L-LE-H\">access</span></div></foreignObject></g></g><g class=\"edgeLabel\" style=\"opacity: 1;\" transform=\"translate(384.5546875,438.5)\"><g transform=\"translate(-44.0234375,-13)\" class=\"label\"><rect rx=\"0\" ry=\"0\" width=\"88.046875\" height=\"26\"></rect><foreignObject width=\"88.046875\" height=\"26\"><div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"display: inline-block; white-space: nowrap;\"><span id=\"L-L-H-C\" class=\"edgeLabel L-LS-H' L-LE-C\">file2#access</span></div></foreignObject></g></g></g><g class=\"nodes\"><g class=\"node default\" id=\"flowchart-F-150\" transform=\"translate(161.375,539.5)\" style=\"opacity: 1;\"><rect rx=\"23\" ry=\"23\" x=\"-35.765625\" y=\"-23\" width=\"71.53125\" height=\"46\" class=\"label-container\"></rect><g class=\"label\" transform=\"translate(0,0)\"><g transform=\"translate(-20.015625,-13)\"><foreignObject width=\"40.03125\" height=\"26\"><div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"display: inline-block; white-space: nowrap;\">user1</div></foreignObject></g></g></g><g class=\"node default\" style=\"opacity: 1;\" id=\"flowchart-C-151\" transform=\"translate(333.10546875,539.5)\"><rect rx=\"23\" ry=\"23\" x=\"-35.765625\" y=\"-23\" width=\"71.53125\" height=\"46\" class=\"label-container\"></rect><g class=\"label\" transform=\"translate(0,0)\"><g transform=\"translate(-20.015625,-13)\"><foreignObject width=\"40.03125\" height=\"26\"><div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"display: inline-block; white-space: nowrap;\">user2</div></foreignObject></g></g></g><g class=\"node default\" style=\"opacity: 1;\" id=\"flowchart-A-146\" transform=\"translate(72.1875,200.5)\"><rect rx=\"0\" ry=\"0\" x=\"-24.6796875\" y=\"-23\" width=\"49.359375\" height=\"46\" class=\"label-container\"></rect><g class=\"label\" transform=\"translate(0,0)\"><g transform=\"translate(-14.6796875,-13)\"><foreignObject width=\"29.359375\" height=\"26\"><div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"display: inline-block; white-space: nowrap;\">file1</div></foreignObject></g></g></g><g class=\"node default\" style=\"opacity: 1;\" id=\"flowchart-E-147\" transform=\"translate(122.32421875,63.5)\"><rect rx=\"0\" ry=\"0\" x=\"-23.34375\" y=\"-23\" width=\"46.6875\" height=\"46\" class=\"label-container\"></rect><g class=\"label\" transform=\"translate(0,0)\"><g transform=\"translate(-13.34375,-13)\"><foreignObject width=\"26.6875\" height=\"26\"><div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"display: inline-block; white-space: nowrap;\">dir1</div></foreignObject></g></g></g><g class=\"node default\" style=\"opacity: 1;\" id=\"flowchart-G-149\" transform=\"translate(278.50390625,200.5)\"><rect rx=\"0\" ry=\"0\" x=\"-24.6796875\" y=\"-23\" width=\"49.359375\" height=\"46\" class=\"label-container\"></rect><g class=\"label\" transform=\"translate(0,0)\"><g transform=\"translate(-14.6796875,-13)\"><foreignObject width=\"29.359375\" height=\"26\"><div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"display: inline-block; white-space: nowrap;\">file2</div></foreignObject></g></g></g><g class=\"node default\" style=\"opacity: 1;\" id=\"flowchart-B-153\" transform=\"translate(72.1875,370)\"><polygon points=\"11.5,0 116.875,0 128.375,-23 116.875,-46 11.5,-46 0,-23\" transform=\"translate(-64.1875,23)\" class=\"label-container\"></polygon><g class=\"label\" transform=\"translate(0,0)\"><g transform=\"translate(-42.6875,-13)\"><foreignObject width=\"85.375\" height=\"26\"><div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"display: inline-block; white-space: nowrap;\">dir1#access</div></foreignObject></g></g></g><g class=\"node default\" style=\"opacity: 1;\" id=\"flowchart-H-163\" transform=\"translate(384.5546875,370)\"><polygon points=\"11.5,0 113.328125,0 124.828125,-23 113.328125,-46 11.5,-46 0,-23\" transform=\"translate(-62.4140625,23)\" class=\"label-container\"></polygon><g class=\"label\" transform=\"translate(0,0)\"><g transform=\"translate(-40.9140625,-13)\"><foreignObject width=\"81.828125\" height=\"26\"><div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"display: inline-block; white-space: nowrap;\">file2#owner</div></foreignObject></g></g></g></g></g></g></svg></p>\n<p>其中实线代表了直接定义的关系，而虚线代表了由<code class=\"language-text\">Subject Set</code>继承而来的关系。</p>\n<h1>Keto</h1>\n<p>Ory/Keto是谷歌Zanzibar的第一个也是目前唯一一个开源实现。Keto用golang实现并兼容Zanzibar的概念，它作为一个单独的服务部署提供了RestfulAPI以及Grpc两种调用方式。后端存储使用了PostgreSQL/MySQL，官方并未公布其具体的性能表现，但比起使用<a href=\"https://research.google/pubs/pub39966/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Spanner</a>的Zanzibar来说，性能应该是差一些的。</p>\n<h2>动手尝试</h2>\n<p>Keto提供了一个简单的例子来展示他是如何工作的</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># clone the repository if you don't have it yet</span>\n<span class=\"token function\">git</span> clone git@github.com:ory/keto.git <span class=\"token operator\">&amp;&amp;</span> <span class=\"token builtin class-name\">cd</span> keto\n\ndocker-compose -f contrib/cat-videos-example/docker-compose.yml up</code></pre></div>\n<p>注意如果这里如果报出了以下错误</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">ERROR: The Compose <span class=\"token function\">file</span> <span class=\"token string\">'./contrib/cat-videos-example/docker-compose.yml'</span> is invalid because:\nservices.keto.volumes contains an invalid type, it should be a string\nservices.keto-init.volumes contains an invalid type, it should be a string</code></pre></div>\n<p>那么你需要将<code class=\"language-text\">contrib/cat-videos-example/docker-compose.yml</code>这个文件的第一行改为<code class=\"language-text\">version: &#39;3.2&#39;</code>\n这里的keto实例使用了内存储存，所以并不需要一个额外的数据库。\n执行</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">docker-compose -f contrib/cat-videos-example/docker-compose.yml <span class=\"token builtin class-name\">exec</span> keto <span class=\"token function\">sh</span></code></pre></div>\n<p>进入到容器中后就可以使用keto的命令行工具了。这里默认装载了<code class=\"language-text\">contrib/cat-videos-example/relation-tuples</code>下的所有规则，在生产环境中可以像这样用keto命令行\n直接装载relation tuples文件，也可以使用API动态添加/删除。执行</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">keto relation-tuple get videos</code></pre></div>\n<p>可以输出在<code class=\"language-text\">videos</code> namespace 下的所有规则</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">videos          /cats           owner           cat lady\nvideos          /cats           view            videos:/cats#owner\nvideos          /cats/1.mp4     owner           videos:/cats#owner\nvideos          /cats/1.mp4     view            *\nvideos          /cats/1.mp4     view            videos:/cats/1.mp4#owner\nvideos          /cats/2.mp4     owner           videos:/cats#owner\nvideos          /cats/2.mp4     view            videos:/cats/2.mp4#owner</code></pre></div>\n<p>检查所有人对<code class=\"language-text\">/cats/2.mp4</code>的访问权限：</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">keto check <span class=\"token string\">\"*\"</span> view videos /cats/2.mp4\nDenied</code></pre></div>\n<p>可以看到输出了拒绝访问, 而<code class=\"language-text\">cat lady</code>由于第1，6，7条规则，是可以访问的</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">keto check &quot;cat lady&quot; view videos /cats/2.mp4\nAllowed</code></pre></div>\n<p>如果想搞明白<code class=\"language-text\">/cats/2.mp4</code>可以被谁访问，以及其原因，可以使用<code class=\"language-text\">expand</code>命令</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">keto <span class=\"token function\">expand</span> view videos /cats/2.mp4\n∪ videos:/cats/2.mp4<span class=\"token comment\">#view</span>\n├─ ∪ videos:/cats/2.mp4<span class=\"token comment\">#owner</span>\n│  ├─ ∪ videos:/cats<span class=\"token comment\">#owner</span>\n│  │  ├─ ☘ <span class=\"token function\">cat</span> lady️</code></pre></div>\n<p>输出的树中<code class=\"language-text\">∪</code>代表了<code class=\"language-text\">Subject Set</code>， 而<code class=\"language-text\">☘</code>代表了最终可以访问<code class=\"language-text\">Object</code>的<code class=\"language-text\">Subject</code>。</p>\n<h2>应用</h2>\n<p>学会了keto和Zanzibar的基础概念和用法后，让我们通过一个例子看一下如何将keto应用到服务的鉴权中去。</p>\n<p>假设我们维护一个多租户的视频服务，我们仅允许特定的视频对某一个租户(tenant)的成员访问。比如下在面这个例子中，我们有一个租户<code class=\"language-text\">cat</code>，视频<code class=\"language-text\">cats.mp4</code>仅允许租户<code class=\"language-text\">cat</code>的<code class=\"language-text\">member</code>观看。对于这个业务我们部署一个<code class=\"language-text\">Profile Service</code>用于用于的注册登陆和验证，以及一个<code class=\"language-text\">Video Service</code>用于为用户提供视频。另外部署了一个Keto服务做集中式的鉴权。</p>\n<p>整个鉴权的流程如下图所示：</p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 700px; '>\n      <a class='gatsby-resp-image-link' href='/static/8759413d80a2b1e05fd8f3004cc44073/c483d/keto-sequence-flow.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 72%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAABZ0lEQVQ4y32TV27EMAxEff87+s+9924reATGUIwgBLQrUuQMm4O6rl0URY5/5L5vl6ap2YZhcOd5mh7Hseu6znye57GDHMdh9rIs3TzPLiBgWRZ74Izj6Pq+d03TGOB1XW7fd9MBzfPcZVlmd4iSJLE7YPgGMBFIEEbY0Nu2NWDskFAB5NyrqjJg2fAjBglAJZh/ykW2bTMgtYA7PhJ8IeeNgz9VGiAZwlQUhTHTC0oiE5wJJgsAyZ6D/7quLyCE6G+GOKkc2GCHAFYOOoAi5k6JvAFEfzWwAAZ6wD9DUekqWRNVOzTd75v8A35QAOIRUPUEm1ZDAV9Q6VT4ZkgJGgSl0MMwDG2SrAV9pSw/K38XfwGSBb3zRTYIpmmybLUW3+z8mD8BFSAHBHYy1OLry2FIkGp3X0ANRYepkpW/FqyUVkgZQ4COP5W8ewggzpowj/7i6iv6r+S3h/oavuLbvmvjD0Q2tegHlQ5D2nOLk7cAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='keto-sequence-flow' title='keto-sequence-flow' src='/static/8759413d80a2b1e05fd8f3004cc44073/8c557/keto-sequence-flow.png' srcset='/static/8759413d80a2b1e05fd8f3004cc44073/4edbd/keto-sequence-flow.png 175w,\n/static/8759413d80a2b1e05fd8f3004cc44073/13ae7/keto-sequence-flow.png 350w,\n/static/8759413d80a2b1e05fd8f3004cc44073/8c557/keto-sequence-flow.png 700w,\n/static/8759413d80a2b1e05fd8f3004cc44073/c483d/keto-sequence-flow.png 751w' sizes='(max-width: 700px) 100vw, 700px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy'>\n  </a>\n    </span></p>\n<p>让我们走一遍整个流程：</p>\n<ol start=\"0\">\n<li>Video Service预先在Keto中写入了一条规则<code class=\"language-text\">videos:cats.mp4#view@(tenants:cat#member)</code>，即仅允许<code class=\"language-text\">tenants:cat</code>的<code class=\"language-text\">member</code>来<code class=\"language-text\">view</code>目标<code class=\"language-text\">videos:cats.mp4</code></li>\n<li>用户<code class=\"language-text\">Felix</code>想要访问<code class=\"language-text\">cats.mp4</code>，但他在系统里并没有注册过，所以以匿名用户的身份对Video Service发起请求</li>\n<li>Video Service接收到请求后向Keto确认主体<code class=\"language-text\">*</code>是否可以访问<code class=\"language-text\">videos:cats.mp4</code>，由于之前写入的规则，请求被Keto判断为拒绝，随即felix的请求也失败了</li>\n<li>felix向Profile Service发起请求注册为租户<code class=\"language-text\">cat</code>的<code class=\"language-text\">member</code>， Profile Service完成注册后向Keto写入了<code class=\"language-text\">tenants:cat#member@felix</code></li>\n<li>注册完成的felix再次向Video Service发起对<code class=\"language-text\">cats.mp4</code>的请求，此时他已经获得了用户<code class=\"language-text\">felix</code>的身份，假设这里他将用户的session放在cookie中发起请求</li>\n<li>Video Service将Cookie中的session提取出来后向Profile Service验证用户，通过后向Keto确认主体<code class=\"language-text\">felix</code>是否可以访问<code class=\"language-text\">videos:cats.mp4</code></li>\n<li>此时由于felix已经是<code class=\"language-text\">tenants:cat</code>的<code class=\"language-text\">member</code>，Keto判定请求通过，最后Video Service将<code class=\"language-text\">cats.mp4</code>返回给Felix</li>\n</ol>\n<p>从这个例子我们可以看到，负责提供视频服务的Video Service自始至终只作了两件事：1. 向Keto写入视频权限规则 2. 向Keto询问某个用户是否有权限。而具体用户的角色<code class=\"language-text\">Role</code>的管理则是由Profile Service统一负责。在这个架构下，我们自己的两个服务在权限这个问题上完全是解耦的，所有的权限规则写入和检验全都由Keto统一负责，显著地增强了整个系统的弹性和可扩展性。</p>\n<h1>总结</h1>\n<p>Zanzibar及其开源实现Ory/Keto致力于实现一套灵活，弹性，可扩展，高可用的鉴权服务体系。Zanzibar在过去的几年中支持了几乎所有的谷歌云上服务，已经印证了它灵活性的价值，而谷歌这一套系统支持全球业务的运维能力也令人赞叹。而Keto也让我们使用这套理念治理自己项目的权限成为可能，但这不意味着Keto就是解决权限问题的银弹，部署一个单独的服务来做中央式权限管理对运维的要求相当高，并且不是每一个项目都需要如此灵活的权限管理。Zanzibar所提出的这套基于<code class=\"language-text\">Relation Tuple</code>的权限管理概念十分值得学习，它找到一个灵活性与复杂度的平衡点，使得相对简单的语法也能支持复杂多变的场景。</p>\n<h3>参考链接</h3>\n<ol>\n<li><a href=\"https://research.google/pubs/pub48190/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://research.google/pubs/pub48190/</a></li>\n<li><a href=\"https://www.youtube.com/watch?v=mstZT431AeQ\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://www.youtube.com/watch?v=mstZT431AeQ</a></li>\n<li><a href=\"https://research.google/pubs/pub39966/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://research.google/pubs/pub39966/</a></li>\n<li><a href=\"https://github.com/ory/keto\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://github.com/ory/keto</a></li>\n<li><a href=\"https://www.ory.sh/keto/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://www.ory.sh/keto/</a></li>\n<li><a href=\"https://www.ory.sh/looking-at-keto/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://www.ory.sh/looking-at-keto/</a></li>\n</ol>","excerpt":"用户的权限管理对每个项目来说都至关重要。不同的业务场景决定了不同的权限管理需求，不同的技术栈也有不同的解决方案：如果你在写一个Ruby On Rails应用，那你可能会选择cancan， 如果你正在使用K8S，那你很可能需要与K8S的RBAC系统打交道。那如果你面对一个非常复杂的业务，需要实现极为灵活的权限配置，并且同时对接多个服务怎么办呢？谷歌的一致性全球授权系统Zanzibar以及其开源实现Ory/Keto或许可以帮到你。 Zanzibar 简介 Google Zanzibar是谷歌201…","frontmatter":{"date":"May 07, 2021","path":"/keto-permission-manager-introduction","title":"Zanzibar与Ory/Keto: 权限管理服务简介"}}},"pageContext":{}},"staticQueryHashes":["1176552510","3649515864","63159454","846684790"]}